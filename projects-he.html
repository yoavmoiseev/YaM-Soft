<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>פרויקטים — YaM SOFT</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <h1>YaM SOFT — פרויקטים</h1>
      <p>מידע מפורט על הפתרונות שלנו</p>
    </div>
    <div class="controls">
      <a href="index.html" class="btn">→ חזרה לעמוד הראשי</a>
    </div>
  </header>

  <main class="projects-detail">
    <section id="projectsContainer"></section>
  </main>

  <footer>
    <p>© ימ סוףט</p>
  </footer>

  <script src="js/reviews.js"></script>
  <script>
    const lang = 'he';
    async function loadData(){
      const [projectsRes, localeRes] = await Promise.all([
        fetch('projects.json'),
        fetch('locales/he.json')
      ]);
      const projects = await projectsRes.json();
      const locale = await localeRes.json();
      const container = document.getElementById('projectsContainer');
      
      projects.forEach(p => {
        const entry = locale.projects.items[p.key] || {};
        
        const projectDiv = document.createElement('div');
        projectDiv.className = 'project-detail';
        projectDiv.id = p.id;
        
        const title = document.createElement('h2');
        title.textContent = entry.title || p.key;
        
        const desc = document.createElement('p');
        desc.className = 'project-description';
        desc.textContent = entry.desc || '';
        
        const video = document.createElement('video');
        video.className = 'project-detail-video';
        video.autoplay = true;
        video.muted = true;
        video.loop = true;
        video.playsInline = true;
        const source = document.createElement('source');
        source.src = p.demoVideo;
        source.type = 'video/mp4';
        video.appendChild(source);
        
        const downloads = document.createElement('div');
        downloads.className = 'downloads';
        
        // Video Instructions (Dropdown or Coming Soon)
        if(p.videoInstructions){
          if(p.videoInstructions.includes('yamsoft.pythonanywhere.com')){
            // Coming soon button
            const videoInstLink = document.createElement('a');
            videoInstLink.className = 'btn';
            videoInstLink.href = '#';
            videoInstLink.textContent = locale.projects.videoInstructions;
            videoInstLink.addEventListener('click', function(e) {
              e.preventDefault();
              alert(locale.projects.videoComingSoon);
            });
            downloads.appendChild(videoInstLink);
          } else {
            // Dropdown with chapters
            const videoWrapper = document.createElement('div');
            videoWrapper.style.display = 'inline-block';
            
            const videoSelect = document.createElement('select');
            videoSelect.className = 'btn';
            videoSelect.style.cursor = 'pointer';
            videoSelect.style.padding = '10px';
            
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = locale.projects.videoInstructions;
            defaultOption.disabled = true;
            defaultOption.selected = true;
            videoSelect.appendChild(defaultOption);
            
            const baseVideoUrl = 'https://drive.google.com/file/d/1mhcCemGvhb8_mL_KqoxjXVK_-CSNkf-Y/view';
            const chapters = [
              { title: 'הצגת המוצר', time: 0 },
              { title: 'כניסה למערכת', time: 1290 },
              { title: 'הזנת נתונים', time: 1620 },
              { title: 'בניית מערכת', time: 3445 },
              { title: 'הגדרות כלליות', time: 4455 },
              { title: 'שמירה בתור PDF', time: 5294 },
              { title: 'יצוא לקובץ אקסל', time: 5630 }
            ];
            
            chapters.forEach(chapter => {
              const option = document.createElement('option');
              option.value = baseVideoUrl + '?t=' + chapter.time + 's';
              option.textContent = chapter.title;
              videoSelect.appendChild(option);
            });
            
            videoSelect.addEventListener('change', function() {
              if(this.value) {
                window.open(this.value, '_blank');
                this.selectedIndex = 0;
              }
            });
            
            videoWrapper.appendChild(videoSelect);
            downloads.appendChild(videoWrapper);
          }
        }
        
        // User Manual
        if(p.userManual && p.userManual[lang]){
          const manualLink = document.createElement('a');
          manualLink.className = 'btn';
          manualLink.href = p.userManual[lang];
          manualLink.target = '_blank';
          manualLink.textContent = locale.projects.userManual;
          downloads.appendChild(manualLink);
        }
        
        // Visit Site
        if(p.siteUrl){
          const siteLink = document.createElement('a');
          siteLink.className = 'btn';
          siteLink.href = p.siteUrl;
          siteLink.target = '_blank';
          siteLink.textContent = locale.projects.visitSite;
          downloads.appendChild(siteLink);
        }

        // Desktop Download (optional) - Drive override for SchoolAutoScheduler and SchoolAutoExam
        if (p.key === 'schoolAutoScheduler' || p.id === 'p1') {
          const dlLink = document.createElement('a');
          dlLink.className = 'btn';
          dlLink.href = 'https://drive.google.com/uc?export=download&id=1s3L6pfOy6rat2gvHNsttsskc6f7UdGY1';
          dlLink.textContent = locale.projects.desktopDownload;
          downloads.appendChild(dlLink);
        } else if (p.key === 'schoolAutoExam' || p.id === 'p2') {
          const dlLink = document.createElement('a');
          dlLink.className = 'btn';
          dlLink.href = 'https://drive.google.com/uc?export=download&id=1SkE4XTJ2p_L4uMdK-DMtpbrP3NuCQjuf';
          dlLink.textContent = locale.projects.desktopDownload;
          downloads.appendChild(dlLink);
        } else if (p.desktopDownload) {
          const dlLink = document.createElement('a');
          dlLink.className = 'btn';
          dlLink.href = p.desktopDownload;
          dlLink.textContent = locale.projects.desktopDownload;
          downloads.appendChild(dlLink);
        }
        
        projectDiv.appendChild(title);
        projectDiv.appendChild(desc);
        projectDiv.appendChild(video);
        projectDiv.appendChild(downloads);
        
        // Reviews section
        const reviewsSection = document.createElement('div');
        reviewsSection.className = 'reviews-section';
        reviewsSection.innerHTML = `
          <h3>${locale.reviews.title}</h3>
          <div class="reviews-list" data-project="${p.id}"></div>
          <div class="review-form-container">
            <h4>${locale.reviews.addReview}</h4>
            <form class="review-form" data-project="${p.id}">
              <input type="text" name="name" placeholder="${locale.reviews.name}" required>
              <input type="text" name="position" placeholder="${locale.reviews.position}" required>
              <textarea name="message" placeholder="${locale.reviews.message}" required></textarea>
              <div class="rating-input">
                <label>${locale.reviews.rating}:</label>
                <select name="rating" required>
                  <option value="5">⭐⭐⭐⭐⭐ (5)</option>
                  <option value="4">⭐⭐⭐⭐ (4)</option>
                  <option value="3">⭐⭐⭐ (3)</option>
                  <option value="2">⭐⭐ (2)</option>
                  <option value="1">⭐ (1)</option>
                </select>
              </div>
              <button type="submit" class="btn">${locale.reviews.submit}</button>
            </form>
          </div>
          <div class="admin-panel">
            <button class="btn admin-toggle">${locale.reviews.adminMode}</button>
          </div>
        `;
        projectDiv.appendChild(reviewsSection);
        
        container.appendChild(projectDiv);
      });
      
      // Initialize reviews system
      if(window.ReviewsManager){
        window.ReviewsManager.init(lang, locale.reviews);
      }
      
      // Scroll to anchor if present in URL
      setTimeout(() => {
        if(window.location.hash) {
          const target = document.querySelector(window.location.hash);
          if(target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }
      }, 100);
    }
    
    loadData();
  </script>
</body>
</html>
